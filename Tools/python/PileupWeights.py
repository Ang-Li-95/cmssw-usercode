pileup_weights = {
    2017: [1.]*100,
    2018: [1.]*100,
    'qcdht0500_2017': [ 0.000239883, 0.025657, 0.0302944, 0.0578158, 0.0588827, 0.0951175, 0.095457, 0.116199, 0.0832559, 0.181199, 0.305928, 0.381734, 0.446511, 0.506407, 0.513821, 0.544976, 0.617625, 0.711982, 0.81026, 0.890853, 0.976609, 1.04614, 1.12355, 1.1759, 1.19933, 1.2118, 1.21653, 1.24351, 1.27396, 1.29001, 1.30249, 1.2671, 1.24186, 1.19912, 1.15559, 1.10515, 1.08157, 1.05159, 0.996624, 0.945884, 0.934242, 0.946055, 0.973661, 1.01748, 1.08012, 1.17296, 1.30823, 1.39537, 1.4873, 1.55788, 1.539, 1.54749, 1.46156, 1.33747, 1.18379, 1.00006, 0.811667, 0.634513, 0.50274, 0.389734, 0.311446, 0.247395, 0.202091, 0.160287, 0.133877, 0.102485, 0.0744413, 0.0669656, 0.0606434, 0.0510635, 0.0422982, 0.0301514, 0.03437, 0.0254581, 0.0180048, 0.0225604, 0.0133125, 0.0138037, 0.00668069, 0.0032371, 0.00152417, 0.0024313, 0.00139956, 0.000653895, 0.000539203, 0.000636983, 0.000647568, 0.000180851, 0.000219995, 0.000254634, 0.00025575, 0.000115217, 0.000152447, 0.000133201, 4.18019e-05, 1.84402e-05, 0.000353215, 0.000740474, 1.62697e-05, 6.3366e-06, 0.00397389, 0, 0.00144177, 0.00171377, 0, 0, 0, 9.76213e-05, 0, 0, 0, 1.91841e-05, 3.49731e-06, 0, 3.05049e-06, 0, 0, 0, 0, 0, 0, 0, 7.43633e-09, 0, 0, 5.74082e-10, 0, 3.89676e-10, 1.82763e-10, 0, 0, 0, 8.04775e-12, 0, 1.61574e-12, 0, 0, 0, 9.55023e-14, ],
    'qcdht0700_2017': [ 0.000283253, 0.0378997, 0.0403223, 0.0788301, 0.0629581, 0.0987909, 0.131847, 0.141474, 0.0992786, 0.229124, 0.324166, 0.415438, 0.487323, 0.504166, 0.531982, 0.567148, 0.617309, 0.69891, 0.802362, 0.887486, 0.964909, 1.03903, 1.11259, 1.16245, 1.18979, 1.19249, 1.21271, 1.23246, 1.25667, 1.2792, 1.28787, 1.26413, 1.22835, 1.1958, 1.14227, 1.09795, 1.07213, 1.04689, 0.987135, 0.942024, 0.927666, 0.944871, 0.961361, 1.00952, 1.0772, 1.1691, 1.29788, 1.38269, 1.49849, 1.54271, 1.54624, 1.51797, 1.47386, 1.33106, 1.16959, 0.981533, 0.798896, 0.633098, 0.496559, 0.390988, 0.312897, 0.244531, 0.201254, 0.157135, 0.131448, 0.100352, 0.0782188, 0.0663506, 0.0564618, 0.0510152, 0.0433818, 0.0289042, 0.0303548, 0.0277129, 0.0146969, 0.0203884, 0.0140235, 0.0137506, 0.00393475, 0.00392988, 0.00130511, 0.00145696, 0.00104482, 0.000844472, 0.000806562, 0.000777587, 0.000220701, 0.000167316, 0.000190679, 8.07263e-05, 0.000327048, 0.000728214, 0.000806057, 0.000349025, 7.1558e-05, 2.36405e-05, 0.000316136, 5.39897e-05, 4.17165e-05, 5.54569e-06, 0, 0, 0.00251381, 0, 0, 0, 0, 0.000170208, 0, 0, 3.02932e-05, 0, 9.14663e-06, 0, 1.32967e-06, 0, 7.44353e-07, 0, 0, 5.12968e-08, 0, 2.60881e-08, 1.29657e-08, 6.38182e-09, 0, 1.50142e-09, 0, 3.39711e-10, 7.96644e-11, 7.39353e-11, 0, 1.54324e-11, 3.50793e-12, 0, 1.40857e-12, ],
    'qcdht1000_2017': [ 0.000340854, 0.0325789, 0.0354852, 0.0782018, 0.0750728, 0.0934269, 0.146046, 0.216951, 0.098258, 0.243503, 0.351195, 0.409593, 0.462163, 0.50596, 0.54355, 0.556491, 0.617328, 0.696891, 0.789221, 0.87725, 0.958322, 1.04774, 1.10539, 1.15773, 1.18045, 1.19414, 1.20392, 1.22091, 1.26854, 1.27769, 1.27326, 1.24786, 1.23031, 1.18663, 1.13525, 1.10169, 1.06688, 1.03633, 0.981087, 0.938514, 0.92341, 0.932033, 0.948914, 0.990357, 1.067, 1.16748, 1.29641, 1.37813, 1.4922, 1.55309, 1.49274, 1.53369, 1.4307, 1.34087, 1.17903, 0.983274, 0.803298, 0.632457, 0.500263, 0.390213, 0.308125, 0.244091, 0.201995, 0.165163, 0.134376, 0.102302, 0.0728823, 0.0626138, 0.0581296, 0.0538043, 0.0461577, 0.0311295, 0.0359697, 0.0342023, 0.0207004, 0.0238608, 0.0125655, 0.00893742, 0.0074219, 0.00329749, 0.00135321, 0.00550803, 0.000804492, 0.000305096, 0.00116765, 0.000525955, 0.000416493, 0.000729167, 0.000245671, 4.98695e-05, 0.000732857, 0.000206457, 0.000870387, 0.00400889, 0.000155278, 1.29274e-05, 0.000337478, 0.000545, 2.22489e-05, 6.77856e-06, 0, 0, 0, 0, 0, 0, 0, 2.96775e-05, 3.36994e-05, 0, 0, 0, 0, 0, 9.27366e-07, 0, 2.59571e-07, 0, 0, 0, 0, 0, 0, 0, 1.0848e-09, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7.32944e-14, ],
    'qcdht1500_2017': [ 0.000303013, 0.0193929, 0.0526114, 0.0666504, 0.0583407, 0.0988358, 0.0946817, 0.110651, 0.0739982, 0.164748, 0.320554, 0.377223, 0.48219, 0.527725, 0.532467, 0.543231, 0.629046, 0.704692, 0.807531, 0.892105, 0.981262, 1.04062, 1.11758, 1.16852, 1.18005, 1.19149, 1.18849, 1.22707, 1.26384, 1.28958, 1.30082, 1.27169, 1.22414, 1.20012, 1.14594, 1.11097, 1.07144, 1.05213, 0.979568, 0.946007, 0.92244, 0.932605, 0.955253, 1.00862, 1.07143, 1.16002, 1.29959, 1.37386, 1.44758, 1.53774, 1.53877, 1.53708, 1.44755, 1.32721, 1.20385, 1.00197, 0.795864, 0.630335, 0.499559, 0.385551, 0.304773, 0.253568, 0.206486, 0.147371, 0.124966, 0.0934501, 0.0747648, 0.0652539, 0.0515719, 0.0566837, 0.0470047, 0.0448459, 0.0254912, 0.0222712, 0.0200444, 0.0332579, 0.0107483, 0.0158424, 0.0125454, 0.00335647, 0.00204755, 0.0035331, 0.00123565, 0.0148498, 0.00143273, 0.00615804, 0.0114733, 0.000327641, 8.33128e-05, 0.000292561, 0.0113149, 0.000873049, 0.000254351, 0.00397603, 0.00467631, 1.14699e-05, 0.000490245, 4.53482e-06, 0.000548043, 8.17965e-06, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.29255e-05, ],
    'qcdht2000_2017': [ 0.000313438, 0.040885, 0.0458968, 0.042591, 0.0687391, 0.093951, 0.191945, 0.131154, 0.089627, 0.23409, 0.339707, 0.428832, 0.454539, 0.500365, 0.538518, 0.563002, 0.614685, 0.7039, 0.815556, 0.86786, 0.965597, 1.03142, 1.12112, 1.14553, 1.18184, 1.20097, 1.20252, 1.24591, 1.25788, 1.28362, 1.27894, 1.25596, 1.21695, 1.19273, 1.1545, 1.11281, 1.0798, 1.04564, 0.98967, 0.924172, 0.928183, 0.935518, 0.969309, 1.01743, 1.06564, 1.17921, 1.30188, 1.41541, 1.50579, 1.54623, 1.51027, 1.5007, 1.48047, 1.24705, 1.13561, 1.00766, 0.795764, 0.635449, 0.492333, 0.392632, 0.310555, 0.248176, 0.203529, 0.156977, 0.124336, 0.103639, 0.0806362, 0.0695215, 0.0463491, 0.050184, 0.0373389, 0.0468627, 0.0357217, 0.0489631, 0.0151967, 0.0317949, 0.0052702, 0.007134, 0.0328413, 0.00202715, 0.00233364, 0.0016594, 0.000396002, 0.000268805, 0.00820985, 0.00989711, 0.000248655, 0.0325988, 0.000451699, 0.000429144, 0.00129677, 0.0125447, 0.00408472, 0.00301774, 0.0067758, 0.000148716, 0.0002723, 0.00113675, 0.00105879, 8.04767e-06, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.05044e-06, 0, 3.05412e-07, 0, 0, 0, 0, 0, 0, 0, 0, 7.32919e-10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.41383e-14, ],
    'ttbar_2017': [ 0.000292199, 0.0366701, 0.036762, 0.0651184, 0.0591087, 0.0960694, 0.110634, 0.140603, 0.0868266, 0.180408, 0.307305, 0.405531, 0.465058, 0.501367, 0.511487, 0.547818, 0.607931, 0.693581, 0.798586, 0.8755, 0.960357, 1.03923, 1.11317, 1.16345, 1.19095, 1.20121, 1.21329, 1.23543, 1.27207, 1.29013, 1.29148, 1.26915, 1.23245, 1.19725, 1.14957, 1.10773, 1.07566, 1.04537, 0.99104, 0.943839, 0.930972, 0.947393, 0.969047, 1.00931, 1.08246, 1.17727, 1.30208, 1.37169, 1.49138, 1.55511, 1.53555, 1.52605, 1.45122, 1.32704, 1.17812, 0.981513, 0.808393, 0.637851, 0.500964, 0.389778, 0.310485, 0.248169, 0.200356, 0.159418, 0.133409, 0.101865, 0.0746221, 0.0643325, 0.0587391, 0.0510397, 0.0421168, 0.0353389, 0.0327759, 0.0282637, 0.0177249, 0.0163034, 0.0129302, 0.0104922, 0.00631025, 0.00304586, 0.00138529, 0.00159469, 0.00201986, 0.000469072, 0.000641474, 0.000404827, 0.000466606, 0.000214621, 0.000115773, 0.00017433, 0.000218639, 0.000276983, 0.000343217, 0.000166979, 3.25466e-05, 1.86218e-05, 4.31702e-05, 4.17331e-05, 1.13933e-05, 6.95449e-06, 0.000102515, 0.004507, 0.00810816, 0.00240945, 0, 0, 0, 5.48998e-05, 7.79247e-05, 8.76663e-05, 0, 5.39432e-05, 5.9004e-06, 7.99163e-06, 2.85919e-06, 0, 2.40087e-06, 6.26065e-07, 6.46796e-07, 8.27276e-08, 0, 4.20729e-08, 0, 6.8614e-09, 3.34459e-09, 1.61425e-09, 3.85862e-10, 0, 2.56953e-10, 4.76949e-11, 1.09478e-10, 4.97765e-11, 1.13146e-11, 0, 0, 2.00058e-12, 0, 1.06122e-13, ],
    'wjetstolnu_2017': [ 0.000262587, 0.0260833, 0.0405197, 0.0677227, 0.0689265, 0.103972, 0.12344, 0.125768, 0.0863078, 0.195692, 0.323036, 0.380278, 0.457486, 0.508659, 0.523203, 0.555885, 0.605332, 0.707131, 0.793412, 0.886643, 0.962596, 1.0432, 1.11808, 1.16547, 1.18014, 1.2032, 1.2111, 1.23427, 1.26772, 1.27888, 1.2971, 1.26372, 1.23156, 1.1954, 1.1474, 1.10229, 1.07488, 1.0408, 0.993559, 0.940276, 0.93647, 0.945023, 0.971285, 1.00957, 1.08484, 1.17865, 1.29518, 1.38962, 1.50071, 1.56458, 1.54261, 1.524, 1.4652, 1.32034, 1.19762, 0.989987, 0.810145, 0.630897, 0.506177, 0.396335, 0.312499, 0.249932, 0.199211, 0.163809, 0.133561, 0.102992, 0.0762521, 0.0671603, 0.0590013, 0.0530819, 0.0415988, 0.0302456, 0.0470698, 0.0307679, 0.0227206, 0.0259643, 0.0155453, 0.0111268, 0.0047593, 0.00695326, 0.00100871, 0.00123936, 0.00343081, 0.000458273, 0.000810626, 0.000724071, 0.00164349, 0.000191144, 0.000146634, 0.000285612, 0.000208819, 9.51113e-05, 0.000890171, 0.00528051, 2.95024e-05, 2.52097e-05, 0.000266014, 2.91591e-05, 1.50231e-05, 7.16723e-06, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.23197e-06, 0, 1.29787e-06, 0, 3.63276e-07, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.76584e-12, ],
    'qcdmupt15_2017': [ 0.000229757, 0.0282354, 0.0297356, 0.0508476, 0.0616523, 0.0965623, 0.12075, 0.117752, 0.0899266, 0.198001, 0.291606, 0.367056, 0.45839, 0.515785, 0.546469, 0.574149, 0.628081, 0.711097, 0.810828, 0.894968, 0.980627, 1.05341, 1.12105, 1.17027, 1.19296, 1.18669, 1.21419, 1.24683, 1.27893, 1.30168, 1.30383, 1.27015, 1.23552, 1.20553, 1.15321, 1.11751, 1.07761, 1.05361, 0.998058, 0.939286, 0.948044, 0.9413, 0.976817, 0.998655, 1.08841, 1.18788, 1.29135, 1.37658, 1.50281, 1.56926, 1.57677, 1.51309, 1.46759, 1.34586, 1.15776, 0.992082, 0.804177, 0.649401, 0.502258, 0.399472, 0.313163, 0.25016, 0.201093, 0.158535, 0.131579, 0.105553, 0.0748289, 0.0608356, 0.0543752, 0.050894, 0.048055, 0.0476216, 0.0285594, 0.0261959, 0.0227083, 0.0139586, 0.00545146, 0.00993601, 0.0097536, 0.0048363, 0.000945148, 0.00229469, 0.00105095, 0.00152915, 0.000523426, 0.00104929, 0.000366821, 0.000112687, 7.24881e-05, 9.71117e-05, 0.000146364, 0.000343648, 0.0163368, 0.000229581, 0.00270998, 8.21115e-06, 0.000379905, 0.00031967, 4.04583e-06, 6.99584e-06, 0, 0, 0.000865985, 0, 0, 0, 0, 0, 0, 1.87262e-05, 0, 5.76135e-06, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4.49355e-09, 4.46655e-09, 0, 1.07165e-09, 0, 0, 0, 5.48873e-11, 0, 0, 0, 0, 0, 0, 0, 7.24056e-14, 2.26684e-14, ],
    'dyjetstollM10_2017': [ 0.000220568, 0.0240519, 0.0246585, 0.0507967, 0.052282, 0.0769537, 0.106085, 0.135462, 0.0864742, 0.164273, 0.271872, 0.358052, 0.437987, 0.488667, 0.509741, 0.548819, 0.610269, 0.715857, 0.809189, 0.891269, 0.980133, 1.0553, 1.12284, 1.17743, 1.20442, 1.21599, 1.22762, 1.25296, 1.28149, 1.30408, 1.30409, 1.27608, 1.24739, 1.20999, 1.15799, 1.11995, 1.08721, 1.04968, 1.0005, 0.949817, 0.939794, 0.950579, 0.982243, 1.02225, 1.0748, 1.17737, 1.31002, 1.37159, 1.48161, 1.56361, 1.56635, 1.5417, 1.4774, 1.3358, 1.18751, 0.985835, 0.819777, 0.639502, 0.503645, 0.394012, 0.314329, 0.251388, 0.199454, 0.166232, 0.133918, 0.104831, 0.0736613, 0.0658412, 0.0589566, 0.0535198, 0.044006, 0.0359172, 0.035002, 0.0327293, 0.0187942, 0.0181401, 0.0128594, 0.00835983, 0.00920536, 0.00263301, 0.00165451, 0.00182219, 0.00165403, 0.000525051, 0.0023695, 0.000608438, 0.000558343, 0.000173645, 0.000220877, 0.000128231, 0.000622999, 0.000121853, 0.000111392, 3.33168e-05, 3.54414e-05, 9.68772e-06, 0.000304483, 7.59075e-05, 0.000455636, 7.54451e-06, 0.00141252, 0, 0.000683303, 0, 0.000717569, 0, 0, 0.000138798, 0, 4.43276e-05, 0, 0, 0, 0, 0, 0, 0, 0, 1.63523e-07, 0, 4.23915e-08, 0, 5.28648e-09, 2.60205e-09, 2.53674e-09, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.71394e-13, 5.36594e-14, 6.78924e-14, ],
    'dyjetstollM50_2017': [ 0.000254311, 0.0258263, 0.0426017, 0.0625583, 0.0534245, 0.0835662, 0.10963, 0.122309, 0.0816237, 0.181453, 0.274456, 0.368128, 0.449024, 0.498257, 0.524853, 0.562499, 0.614334, 0.705196, 0.80316, 0.891007, 0.971385, 1.06026, 1.12217, 1.17104, 1.20186, 1.20383, 1.21453, 1.24219, 1.27772, 1.29198, 1.3041, 1.27249, 1.23894, 1.20023, 1.15479, 1.11779, 1.07896, 1.04455, 0.985327, 0.95096, 0.93733, 0.94968, 0.966686, 1.01003, 1.08216, 1.18733, 1.30312, 1.37967, 1.47566, 1.53332, 1.52542, 1.52003, 1.46022, 1.34003, 1.19944, 0.984925, 0.809119, 0.645609, 0.502873, 0.39217, 0.307661, 0.245732, 0.204274, 0.162644, 0.131251, 0.102325, 0.0769848, 0.0693302, 0.0553776, 0.0504492, 0.0439711, 0.0301347, 0.034492, 0.0356486, 0.0206814, 0.0141814, 0.0166489, 0.010441, 0.0047654, 0.00830654, 0.00121732, 0.000755189, 0.00220558, 0.000690939, 0.000638307, 0.00024508, 0.000334796, 0.000258798, 7.84401e-05, 6.35935e-05, 0.000437979, 0.000138395, 0.000352797, 0.0079997, 5.00493e-05, 1.0699e-05, 0.000270819, 0.000987584, 0.000453264, 7.90436e-06, 0.00195872, 0, 0, 0, 0, 0.00014519, 0, 0, 0, 0, 0, 0, 0, 0, 1.50357e-06, 0, 0, 0, 0, 0, 0, 0, 0, 3.60823e-09, 0, 8.48889e-10, 0, 0, 9.00832e-11, 0, 0, 8.72537e-12, 0, 0, 7.96391e-13, ],

    'mfv_signals': [ 0.204844, 7.61552, 2.72784, 3.44627, 1.43511, 1.35153, 1.1955, 1.11221, 0.468732, 0.757386, 0.897203, 0.892601, 0.921545, 0.873725, 0.762869, 0.724287, 0.745349, 0.774066, 0.862415, 0.908246, 0.967304, 1.04186, 1.07539, 1.10086, 1.1166, 1.12824, 1.13738, 1.15727, 1.18049, 1.19585, 1.19359, 1.18151, 1.14173, 1.09574, 1.0704, 1.02597, 0.982455, 0.960011, 0.916674, 0.867444, 0.854389, 0.861624, 0.886026, 0.929545, 0.996872, 1.08168, 1.20219, 1.30824, 1.38742, 1.43308, 1.46876, 1.45768, 1.38017, 1.27433, 1.12157, 0.933378, 0.774365, 0.61096, 0.482154, 0.366463, 0.292627, 0.235782, 0.195432, 0.158564, 0.133163, 0.10161, 0.0745418, 0.0653409, 0.0604925, 0.0520199, 0.0485005, 0.0462587, 0.0423882, 0.0476483, 0.0408821, 0.0351915, 0.0294714, 0.0545649, 0.0372684, 0.0462814, 0.0423416, 0.0290524, 0.0341293, 0.040834, 0.111314, 0, 0, 0.0114432, 0, 0, 0.0100715, ],
    }

# https://hypernews.cern.ch/HyperNews/CMS/get/physics-validation/3007.html
# bug in npu distribution for official MC samples, advised to check per-sample.
# few % difference especially wrt peak at 0 and extra at 75-100, so could
# apply per-sample weights.
#
# for our private signal samples, no bug, so use weights above

pileup_weights[2017] = pileup_weights['ttbar_2017']

########################################################################

class derive_weights(object):
    def __init__(self, data_fn, mc_fn, data_path='pileup', mc_path='PileupDist/h_npu', tol=1e-9, raise_tol=True):
        from JMTucker.Tools.ROOTTools import ROOT

        self.data_f = ROOT.TFile(data_fn)
        self.mc_f   = ROOT.TFile(mc_fn)
        self.data_h = self.data_f.Get(data_path)
        self.mc_h   = self.mc_f.Get(mc_path)

        def norm(h):
            h = h.Clone(h.GetName() + '_norm')
            h.Sumw2()
            h.Scale(1/h.Integral(1, h.GetNbinsX()+1))
            return h

        self.data_h.SetLineColor(ROOT.kBlack)
        self.data_h.SetLineWidth(2)
        self.mc_h.SetLineColor(ROOT.kRed)
        self.mc_h.SetLineWidth(2)

        self.data_h_orig = self.data_h
        self.mc_h_orig   = self.mc_h

        self.data_h = norm(self.data_h)
        self.mc_h   = norm(self.mc_h)

        self.ndata = self.data_h.GetNbinsX()
        assert self.ndata == self.mc_h.GetNbinsX() # JMTBAD

        self.weights = []

        for i in xrange(1, self.ndata+1):
            d = self.data_h.GetBinContent(i)
            m = self.mc_h.GetBinContent(i)
            w = -1
            if m == 0:
                if d > tol:
                    msg = 'm == 0 and d = %g > tol=%g for i = %i' % (d, tol, i)
                    if raise_tol:
                        raise ValueError(msg)
                    else:
                        print msg
                w = 0
            else:
                w = d/m
            self.weights.append(w)

        while self.weights[-1] == 0:
            self.weights.pop()


if __name__ == '__main__':
    import sys
    if len(sys.argv) < 3:
        sys.exit('usage: %s data_fn mc_fn [mc_fn2 ...]')

    data_fn = sys.argv[1]
    for mc_fn in sys.argv[2:]:
        ww = derive_weights(data_fn, mc_fn, raise_tol=False)
        print mc_fn, '[',
        for w in ww.weights:
            print '%.6g,' % w,
        print ']'
