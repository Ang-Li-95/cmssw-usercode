#!/usr/bin/env python

import os, sys
from pprint import pprint
from JMTucker.Tools.general import bool_from_argv
from JMTucker.Tools.CondorTools import cs_dirs_from_argv

stdout = bool_from_argv('stdout')
edit = bool_from_argv('edit')
if stdout and edit:
    raise ValueError('cannot edit when dumping to stdout')

wds = cs_dirs_from_argv()
if not wds:
    print 'No condor dirs in argv\n'
    sys.exit(1)

for wd in wds:
    execfile(os.path.join(wd, 'cs_filelist.py'))

    if stdout:
        f = sys.stdout
    else:
        f = open(os.path.join(wd, 'cs_filelist2.py'), 'wt')

    f.write('_l = ')
    pprint(_l, f)
    f.write('\ndef get(i): return _l[i]\n')

    if not stdout:
        f.close()

    if edit:
        os.system('emacs -nw cs_filelist.py cs_filelist2.py')
        raw_input('hit enter to replace, ^C to cancel '):
        bak_fn = 'cs_filelist.py.bak'
        while os.path.isfile(bak_fn):
            bak_fn += '.bak'
        os.rename('cs_filelist.py', bak_fn)
        os.rename('cs_filelist2.py', 'cs_filelist.py')
